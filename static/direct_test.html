<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Direct Socket.IO Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: #fff;
            font-family: Arial, sans-serif;
        }

        .controls {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        button:hover {
            background: #c0392b;
        }

        #debug {
            background: #111;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }

        .background-test {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            /* ensure full image is visible */
            background-position: center;
            background-repeat: no-repeat;
            z-index: -1;
            display: none;
        }
    </style>
</head>

<body>
    <div class="controls">
        <h2>üîß Direct Socket.IO Test</h2>
        <button onclick="testDragon()">Test Dragon Event</button>
        <button onclick="testVault()">Test Vault Event</button>
        <button onclick="testDirectImage()">Show Dragon Direct</button>
        <button onclick="clearBg()">Clear</button>
        <p><strong>Status:</strong> <span id="status">Connecting...</span></p>
    </div>

    <div id="debug">
        <strong>Debug Log:</strong><br>
        <div id="log"></div>
    </div>

    <div id="bg" class="background-test"></div>

    <script src="/static/socket.io.js"></script>
    <script>
        let socket = null;

        function log(msg) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + msg + '<br>';
            console.log(msg);
        }

        function testDragon() {
            log('üêâ Sending test_dragon event...');
            if (socket && socket.connected) {
                socket.emit('test_dragon');
            } else {
                log('‚ùå Socket not connected!');
            }
        }

        function testVault() {
            log('üèõÔ∏è Sending test_vault event...');
            if (socket && socket.connected) {
                socket.emit('test_vault');
            } else {
                log('‚ùå Socket not connected!');
            }
        }

        function testDirectImage() {
            log('üì∏ Testing direct image display...');
            const bg = document.getElementById('bg');
            bg.style.backgroundImage = 'url(/static/images/dragon.png)';
            bg.style.display = 'block';
            log('‚úÖ Direct image should be visible now');
        }

        function clearBg() {
            log('üßπ Clearing background...');
            document.getElementById('bg').style.display = 'none';
        }

        // Initialize Socket.IO
        window.addEventListener('load', () => {
            log('üîå Initializing Socket.IO...');
            socket = io();

            socket.on('connect', () => {
                log('‚úÖ Socket.IO connected!');
                document.getElementById('status').textContent = 'Connected';
            });

            socket.on('disconnect', () => {
                log('‚ùå Socket.IO disconnected!');
                document.getElementById('status').textContent = 'Disconnected';
            });

            socket.on('scene', (data) => {
                log('üé¨ Scene event received: ' + JSON.stringify(data));
                if (data.background) {
                    const bg = document.getElementById('bg');
                    bg.style.backgroundImage = `url(/static/images/${data.background})`;
                    bg.style.display = 'block';
                    log('‚úÖ Background set to: ' + data.background);
                } else {
                    document.getElementById('bg').style.display = 'none';
                    log('üßπ Background cleared');
                }
            });

            socket.on('connect_error', (error) => {
                log('‚ùå Connection error: ' + error);
            });
        });
    </script>
</body>

</html>